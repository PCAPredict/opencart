<?xml version="1.0" encoding="UTF-8"?>
<modification>
	<id>PCA Predict Address Validation</id>
	<version>1.0.0.0</version>
	<vqmver>2.2.1</vqmver>
	<author>https://www.pcapredict.com</author>
	<!-- Dropping the control globally accross the site. -->
	<file name="catalog/controller/common/header.php">
		<operation error="skip" info="for 2.0.x and 2.1.x">
			<search position="after">
                <![CDATA[public function index() {]]>
            </search>
			<add>
				<![CDATA[
					$data['pcapredict_account_code'] = $this->config->get('pcapredict_account_code');
					$data['pcapredict_custom_javascript'] = $this->config->get('pcapredict_custom_javascript');
				]]>
            </add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/common/header.tpl">
		<operation error="skip" info="for 2.0.x and 2.1.x">
			<search position="before">
                <![CDATA[</head>]]>
            </search>
			<add>
				<![CDATA[
					<script src="catalog/view/javascript/module/pcapredict.js" type="text/javascript"></script>
					<script>init_pca_tag('<?php echo $pcapredict_account_code; ?>');</script>
					<?php if (strlen($pcapredict_custom_javascript) > 0) { ?><script><?php echo $pcapredict_custom_javascript; ?></script><?php } ?>
				]]>
            </add>
		</operation>
	</file>
	<!-- Getting the control onto the guest checkout payment fields. -->
	<file name="catalog/controller/checkout/shipping_address.php,catalog/controller/checkout/payment_address.php,catalog/controller/checkout/guest.php,catalog/controller/checkout/guest_shipping.php,catalog/controller/checkout/register.php">
		<operation error="skip" info="for 2.0.x and 2.1.x">
			<search position="after">
                <![CDATA[public function index() {]]>
            </search>
			<add>
				<![CDATA[
					$data['pcapredict_init_code'] = 'console.log("Loading PCA"); pca.load();';
				]]>
            </add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/shipping_address.tpl,catalog/view/theme/*/template/checkout/payment_address.tpl,catalog/view/theme/*/template/checkout/guest.tpl,catalog/view/theme/*/template/checkout/guest_shipping.tpl,catalog/view/theme/*/template/checkout/register.tpl">
		<operation error="skip" info="for 2.0.x and 2.1.x">
			<search position="bottom">
				<![CDATA[]]>
			</search>
			<add>
				<![CDATA[<script><?php echo $pcapredict_init_code; ?></script>]]>
            </add>
		</operation>
	</file>
</modification>